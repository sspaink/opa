{
	"cases": [
		{
			"note": "refheads/single-value",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np.q.r := 1\n\np.q.s := 2\n"
			],
			"want_result": [
				{
					"x": {
						"q": {
							"r": 1,
							"s": 2
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "q"
						},
						{
							"value": "r"
						},
						{
							"value": "1"
						},
						{
							"value": "s"
						},
						{
							"value": "2"
						},
						{
							"value": "test"
						},
						{
							"value": "p"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.p.q.r",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 2
																	},
																	"value": {
																		"type": "local",
																		"value": 4
																	},
																	"object": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.p.q.s",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 5,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 4
																	},
																	"value": {
																		"type": "local",
																		"value": 5
																	},
																	"object": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"target": 7,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 7
																						},
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"target": 8,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 8,
																						"b": 2,
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 6,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 6
												},
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 9
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.p.q.r",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p",
								"q",
								"r"
							]
						},
						{
							"name": "g0.data.test.p.q.s",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 5,
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p",
								"q",
								"s"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"q": {
							"r": 1,
							"s": 2
						}
					}
				}
			]
		},
		{
			"note": "refheads/single-value, with var",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np.q.r := 1\n\np.q[s] := 2 if s := \"s\"\n"
			],
			"want_result": [
				{
					"x": {
						"q": {
							"r": 1,
							"s": 2
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "q"
						},
						{
							"value": "1"
						},
						{
							"value": "r"
						},
						{
							"value": "s"
						},
						{
							"value": "2"
						},
						{
							"value": "test"
						},
						{
							"value": "p"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.p.q",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"value": {
																		"type": "local",
																		"value": 3
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"target": 5,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 5
																						},
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 6,
																						"b": 2,
																						"target": 4,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 7,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 7
												},
												"object": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.p.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 3
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 4
												},
												"target": 4,
												"file": 1,
												"col": 16,
												"row": 5
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 5,
												"target": 5,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 4
												},
												"value": {
													"type": "local",
													"value": 5
												},
												"object": 2,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p",
								"q"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"q": {
							"r": 1,
							"s": 2
						}
					}
				}
			]
		},
		{
			"note": "refheads/single-value, with var, conflict",
			"query": "data.test.p.q = x",
			"modules": [
				"package test\n\np.q.r := 1\n\np.q[s] := 2 if s := \"r\"\n"
			],
			"want_error_code": "eval_conflict_error",
			"want_error": "object keys must be unique",
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "1"
						},
						{
							"value": "r"
						},
						{
							"value": "2"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.p.q",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.p.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 2
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 2
												},
												"target": 4,
												"file": 0,
												"col": 16,
												"row": 5
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 4
												},
												"value": {
													"type": "local",
													"value": 5
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p",
								"q"
							]
						}
					]
				}
			},
			"want_plan_result": null
		},
		{
			"note": "refheads/complete: direct query",
			"query": "data.test.a.b.c.p = x",
			"modules": [
				"package test\n\na.b.c.p := true\n"
			],
			"want_result": [
				{
					"x": true
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a.b.c.p",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b.c.p",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "bool",
													"value": true
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c",
								"p"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": true
				}
			]
		},
		{
			"note": "refheads/complete: direct query q",
			"query": "data.test.q = x",
			"modules": [
				"package test\n\nq := 0\n"
			],
			"want_result": [
				{
					"x": 0
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "0"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.q",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"q"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": 0
				}
			]
		},
		{
			"note": "refheads/complete: full package extent",
			"query": "data.test = x",
			"modules": [
				"package test\n\na.b.c.p := true\n"
			],
			"want_result": [
				{
					"x": {
						"a": {
							"b": {
								"c": {
									"p": true
								}
							}
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "p"
						},
						{
							"value": "test"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.c.p",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 6,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 4
																	},
																	"value": {
																		"type": "local",
																		"value": 6
																	},
																	"object": 5,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 3
												},
												"value": {
													"type": "local",
													"value": 5
												},
												"object": 4,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 2
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"target": 8,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 8,
																						"b": 2,
																						"target": 7,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 7,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 7
												},
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 9
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b.c.p",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "bool",
													"value": true
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c",
								"p"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"a": {
							"b": {
								"c": {
									"p": true
								}
							}
						}
					}
				}
			]
		},
		{
			"note": "refheads/complete+mixed",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\na.b.c.p := 1\n\nq := 0\n\na.b.d := 3\n\np if {\n\tq == 0\n\ta.b.c.p == 1\n\ta.b.d == 3\n}\n"
			],
			"want_result": [
				{
					"x": true
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "0"
						},
						{
							"value": "1"
						},
						{
							"value": "3"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.p",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"q"
							]
						},
						{
							"name": "g0.data.test.a.b.c.p",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c",
								"p"
							]
						},
						{
							"name": "g0.data.test.a.b.d",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 7
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 7
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 7
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 7
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 7
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 7
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"d"
							]
						},
						{
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 9
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.q",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 4,
												"file": 0,
												"col": 2,
												"row": 10
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 5,
												"file": 0,
												"col": 2,
												"row": 10
											}
										},
										{
											"type": "EqualStmt",
											"stmt": {
												"a": {
													"type": "local",
													"value": 4
												},
												"b": {
													"type": "local",
													"value": 5
												},
												"file": 0,
												"col": 2,
												"row": 10
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a.b.c.p",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 6,
												"file": 0,
												"col": 2,
												"row": 11
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 7,
												"file": 0,
												"col": 2,
												"row": 11
											}
										},
										{
											"type": "EqualStmt",
											"stmt": {
												"a": {
													"type": "local",
													"value": 6
												},
												"b": {
													"type": "local",
													"value": 7
												},
												"file": 0,
												"col": 2,
												"row": 11
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a.b.d",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 8,
												"file": 0,
												"col": 2,
												"row": 12
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 9,
												"file": 0,
												"col": 2,
												"row": 12
											}
										},
										{
											"type": "EqualStmt",
											"stmt": {
												"a": {
													"type": "local",
													"value": 8
												},
												"b": {
													"type": "local",
													"value": 9
												},
												"file": 0,
												"col": 2,
												"row": 12
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "bool",
													"value": true
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 9
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 9
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 9
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 9
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": true
				}
			]
		},
		{
			"note": "refheads/single-value rule",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\na.b[x] := y if {\n\tx := \"c\"\n\ty := \"d\"\n}\n"
			],
			"want_result": [
				{
					"x": {
						"b": {
							"c": "d"
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "d"
						},
						{
							"value": "test"
						},
						{
							"value": "a"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"value": {
																		"type": "local",
																		"value": 3
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 4
																						},
																						"target": 5,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 5
																						},
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 6,
																						"b": 2,
																						"target": 4,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 7,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 7
												},
												"object": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 2
												},
												"target": 4,
												"file": 1,
												"col": 2,
												"row": 4
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 3
												},
												"target": 5,
												"file": 1,
												"col": 2,
												"row": 5
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 4
												},
												"value": {
													"type": "local",
													"value": 5
												},
												"object": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"b": {
							"c": "d"
						}
					}
				}
			]
		},
		{
			"note": "refheads/multi-value",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\na.b contains x if some x in [1, 2, 3]\n"
			],
			"want_result": [
				{
					"x": {
						"b": [
							1,
							2,
							3
						]
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "b"
						},
						{
							"value": "1"
						},
						{
							"value": "2"
						},
						{
							"value": "3"
						},
						{
							"value": "test"
						},
						{
							"value": "a"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"value": {
																		"type": "local",
																		"value": 3
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"target": 5,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 5
																						},
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 6,
																						"b": 2,
																						"target": 4,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 7,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 7
												},
												"object": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeSetStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 4,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 5,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 5
												},
												"array": 4,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 6,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 6
												},
												"array": 4,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 4,
												"target": 7,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 7
												},
												"array": 4,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 8,
												"file": 1,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 8,
												"key": 9,
												"value": 10,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 9
																},
																"target": 11,
																"file": 1,
																"col": 19,
																"row": 3
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 10
																},
																"target": 12,
																"file": 1,
																"col": 19,
																"row": 3
															}
														},
														{
															"type": "SetAddStmt",
															"stmt": {
																"value": {
																	"type": "local",
																	"value": 12
																},
																"set": 2,
																"file": 1,
																"col": 1,
																"row": 3
															}
														}
													]
												},
												"file": 1,
												"col": 19,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"b": [
							1,
							2,
							3
						]
					}
				}
			]
		},
		{
			"note": "refheads/single-value: previously partial object",
			"query": "data.test.a.b = x",
			"modules": [
				"package test\n\na.b[x] := i if some i, x in [1, 2, 3]\n"
			],
			"want_result": [
				{
					"x": {
						"1": 0,
						"2": 1,
						"3": 2
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "1"
						},
						{
							"value": "2"
						},
						{
							"value": "3"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a.b",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 4,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 5,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 5
												},
												"array": 4,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 6,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 6
												},
												"array": 4,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 3,
												"target": 7,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 7
												},
												"array": 4,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 8,
												"file": 0,
												"col": 29,
												"row": 3
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 8,
												"key": 9,
												"value": 10,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 9
																},
																"target": 11,
																"file": 0,
																"col": 16,
																"row": 3
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 10
																},
																"target": 12,
																"file": 0,
																"col": 16,
																"row": 3
															}
														},
														{
															"type": "ObjectInsertOnceStmt",
															"stmt": {
																"key": {
																	"type": "local",
																	"value": 12
																},
																"value": {
																	"type": "local",
																	"value": 11
																},
																"object": 2,
																"file": 0,
																"col": 1,
																"row": 3
															}
														}
													]
												},
												"file": 0,
												"col": 16,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"1": 0,
						"2": 1,
						"3": 2
					}
				}
			]
		},
		{
			"note": "refheads/multi-value: same rule",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\na.b.c.d contains 1\n",
				"package test.a\n\nb.c.d contains 2\n"
			],
			"want_result": [
				{
					"x": {
						"b": {
							"c": {
								"d": [
									1,
									2
								]
							}
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "d"
						},
						{
							"value": "2"
						},
						{
							"value": "1"
						},
						{
							"value": "test"
						},
						{
							"value": "a"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-1.rego"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.c.d",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 5,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 3
																	},
																	"value": {
																		"type": "local",
																		"value": 5
																	},
																	"object": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 2
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 6
																						},
																						"target": 7,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 7
																						},
																						"key": {
																							"type": "string_index",
																							"value": 7
																						},
																						"target": 8,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 8,
																						"b": 2,
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 6,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 6
												},
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 9
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 10,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b.c.d",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeSetStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 4,
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "SetAddStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 4
												},
												"set": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 2,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 5,
												"target": 4,
												"file": 2,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "SetAddStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 4
												},
												"set": 2,
												"file": 2,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c",
								"d"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"b": {
							"c": {
								"d": [
									1,
									2
								]
							}
						}
					}
				}
			]
		},
		{
			"note": "refheads/single-value default rule",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\ndefault a.b.c := \"d\"\n"
			],
			"want_result": [
				{
					"x": {
						"b": {
							"c": "d"
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "b"
						},
						{
							"value": "c"
						},
						{
							"value": "d"
						},
						{
							"value": "test"
						},
						{
							"value": "a"
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.c",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 2
																	},
																	"value": {
																		"type": "local",
																		"value": 4
																	},
																	"object": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 4
																						},
																						"target": 6,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 6
																						},
																						"key": {
																							"type": "string_index",
																							"value": 5
																						},
																						"target": 7,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 7,
																						"b": 2,
																						"target": 5,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 5,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 5
												},
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 8
												},
												"object": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 9,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b.c",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "IsUndefinedStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 9,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 9,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 9,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"b": {
							"c": "d"
						}
					}
				}
			]
		},
		{
			"note": "refheads/single-value example",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\nq[7] := 8\n\na[x] if q[x]\n"
			],
			"want_result": [
				{
					"x": {
						"7": true
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "8"
						},
						{
							"value": "7"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"q"
							]
						},
						{
							"name": "g0.data.test.a",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.q",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 4,
												"file": 0,
												"col": 9,
												"row": 5
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 4,
												"key": 5,
												"value": 6,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 5
																},
																"target": 7,
																"file": 0,
																"col": 9,
																"row": 5
															}
														},
														{
															"type": "NotEqualStmt",
															"stmt": {
																"a": {
																	"type": "local",
																	"value": 6
																},
																"b": {
																	"type": "bool",
																	"value": false
																},
																"file": 0,
																"col": 9,
																"row": 5
															}
														},
														{
															"type": "ObjectInsertOnceStmt",
															"stmt": {
																"key": {
																	"type": "local",
																	"value": 7
																},
																"value": {
																	"type": "bool",
																	"value": true
																},
																"object": 2,
																"file": 0,
																"col": 1,
																"row": 5
															}
														}
													]
												},
												"file": 0,
												"col": 9,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"7": true
					}
				}
			]
		},
		{
			"note": "refheads/single-value example, false",
			"query": "data.test.a = x",
			"modules": [
				"package test\n\nq[7] := 8 if false\n\na[x] if q[x]\n"
			],
			"want_result": [
				{
					"x": {}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "8"
						},
						{
							"value": "7"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.a",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.q",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "BreakStmt",
											"stmt": {
												"index": 0,
												"file": 0,
												"col": 14,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"q"
							]
						},
						{
							"name": "g0.data.test.a",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.q",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 4,
												"file": 0,
												"col": 9,
												"row": 5
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 4,
												"key": 5,
												"value": 6,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 5
																},
																"target": 7,
																"file": 0,
																"col": 9,
																"row": 5
															}
														},
														{
															"type": "NotEqualStmt",
															"stmt": {
																"a": {
																	"type": "local",
																	"value": 6
																},
																"b": {
																	"type": "bool",
																	"value": false
																},
																"file": 0,
																"col": 9,
																"row": 5
															}
														},
														{
															"type": "ObjectInsertOnceStmt",
															"stmt": {
																"key": {
																	"type": "local",
																	"value": 7
																},
																"value": {
																	"type": "bool",
																	"value": true
																},
																"object": 2,
																"file": 0,
																"col": 1,
																"row": 5
															}
														}
													]
												},
												"file": 0,
												"col": 9,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 5
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {}
				}
			]
		},
		{
			"note": "refheads/mixed example, multiple rules",
			"query": "data.test.a.b = x",
			"modules": [
				"package test\n\na.b.c := \"d\"\n\na.b.e := \"f\"\n\na.b.g contains x if some x in numbers.range(1, 3)\n\na.b.h[x] := 1 if x := \"one\"\n"
			],
			"want_result": [
				{
					"x": {
						"c": "d",
						"e": "f",
						"g": [
							1,
							2,
							3
						],
						"h": {
							"one": 1
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "c"
						},
						{
							"value": "d"
						},
						{
							"value": "e"
						},
						{
							"value": "f"
						},
						{
							"value": "g"
						},
						{
							"value": "1"
						},
						{
							"value": "3"
						},
						{
							"value": "h"
						},
						{
							"value": "one"
						},
						{
							"value": "test"
						},
						{
							"value": "a"
						},
						{
							"value": "b"
						}
					],
					"builtin_funcs": [
						{
							"name": "numbers.range",
							"decl": {
								"args": [
									{
										"description": "the start of the range",
										"name": "a",
										"type": "number"
									},
									{
										"description": "the end of the range (inclusive)",
										"name": "b",
										"type": "number"
									}
								],
								"result": {
									"description": "the range between `a` and `b`",
									"dynamic": {
										"type": "number"
									},
									"name": "range",
									"type": "array"
								},
								"type": "function"
							}
						}
					],
					"files": [
						{
							"value": "\u003cquery\u003e"
						},
						{
							"value": "module-0.rego"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.c",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 3,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 1
																	},
																	"value": {
																		"type": "local",
																		"value": 3
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.e",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 4,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 3
																	},
																	"value": {
																		"type": "local",
																		"value": 4
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.g",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 5,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 5
																	},
																	"value": {
																		"type": "local",
																		"value": 5
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "CallStmt",
																"stmt": {
																	"func": "g0.data.test.a.b.h",
																	"args": [
																		{
																			"type": "local",
																			"value": 0
																		},
																		{
																			"type": "local",
																			"value": 1
																		}
																	],
																	"result": 6,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "ObjectInsertStmt",
																"stmt": {
																	"key": {
																		"type": "string_index",
																		"value": 8
																	},
																	"value": {
																		"type": "local",
																		"value": 6
																	},
																	"object": 2,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "BlockStmt",
											"stmt": {
												"blocks": [
													{
														"stmts": [
															{
																"type": "BlockStmt",
																"stmt": {
																	"blocks": [
																		{
																			"stmts": [
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 1
																						},
																						"key": {
																							"type": "string_index",
																							"value": 10
																						},
																						"target": 8,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 8
																						},
																						"key": {
																							"type": "string_index",
																							"value": 11
																						},
																						"target": 9,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "DotStmt",
																					"stmt": {
																						"source": {
																							"type": "local",
																							"value": 9
																						},
																						"key": {
																							"type": "string_index",
																							"value": 12
																						},
																						"target": 10,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "ObjectMergeStmt",
																					"stmt": {
																						"a": 10,
																						"b": 2,
																						"target": 7,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				},
																				{
																					"type": "BreakStmt",
																					"stmt": {
																						"index": 1,
																						"file": 0,
																						"col": 1,
																						"row": 1
																					}
																				}
																			]
																		}
																	],
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															},
															{
																"type": "AssignVarStmt",
																"stmt": {
																	"source": {
																		"type": "local",
																		"value": 2
																	},
																	"target": 7,
																	"file": 0,
																	"col": 1,
																	"row": 1
																}
															}
														]
													}
												],
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 7
												},
												"target": 11,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 12,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 11
												},
												"object": 12,
												"file": 0,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 12,
												"file": 0,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.a.b.c",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 1,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"c"
							]
						},
						{
							"name": "g0.data.test.a.b.e",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 4
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 1,
												"col": 1,
												"row": 5
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 5
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"e"
							]
						},
						{
							"name": "g0.data.test.a.b.g",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeSetStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 7
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 7
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 6,
												"target": 4,
												"file": 1,
												"col": 31,
												"row": 7
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 7,
												"target": 5,
												"file": 1,
												"col": 31,
												"row": 7
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "numbers.range",
												"args": [
													{
														"type": "local",
														"value": 4
													},
													{
														"type": "local",
														"value": 5
													}
												],
												"result": 6,
												"file": 1,
												"col": 31,
												"row": 7
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 6
												},
												"target": 7,
												"file": 1,
												"col": 31,
												"row": 7
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 7,
												"key": 8,
												"value": 9,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 8
																},
																"target": 10,
																"file": 1,
																"col": 21,
																"row": 7
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 9
																},
																"target": 11,
																"file": 1,
																"col": 21,
																"row": 7
															}
														},
														{
															"type": "SetAddStmt",
															"stmt": {
																"value": {
																	"type": "local",
																	"value": 11
																},
																"set": 2,
																"file": 1,
																"col": 1,
																"row": 7
															}
														}
													]
												},
												"file": 1,
												"col": 21,
												"row": 7
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 7
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"g"
							]
						},
						{
							"name": "g0.data.test.a.b.h",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 1,
												"col": 1,
												"row": 9
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 9
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "string_index",
													"value": 9
												},
												"target": 4,
												"file": 1,
												"col": 18,
												"row": 9
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 6,
												"target": 5,
												"file": 1,
												"col": 1,
												"row": 9
											}
										},
										{
											"type": "ObjectInsertOnceStmt",
											"stmt": {
												"key": {
													"type": "local",
													"value": 4
												},
												"value": {
													"type": "local",
													"value": 5
												},
												"object": 2,
												"file": 1,
												"col": 1,
												"row": 9
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 1,
												"col": 1,
												"row": 9
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"a",
								"b",
								"h"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"c": "d",
						"e": "f",
						"g": [
							1,
							2,
							3
						],
						"h": {
							"one": 1
						}
					}
				}
			]
		},
		{
			"note": "refheads/website-example/partial-obj",
			"query": "data.example.apps_by_hostname.helium = x",
			"modules": [
				"package example\n\napps_by_hostname[hostname] := app if {\n\tsome i\n\tserver := sites[_].servers[_]\n\thostname := server.hostname\n\tapps[i].servers[_] == server.name\n\tapp := apps[i].name\n}\n\nsites := [\n\t{\n\t\t\"region\": \"east\",\n\t\t\"name\": \"prod\",\n\t\t\"servers\": [\n\t\t\t{\n\t\t\t\t\"name\": \"web-0\",\n\t\t\t\t\"hostname\": \"hydrogen\",\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"web-1\",\n\t\t\t\t\"hostname\": \"helium\",\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"db-0\",\n\t\t\t\t\"hostname\": \"lithium\",\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\t\"region\": \"west\",\n\t\t\"name\": \"smoke\",\n\t\t\"servers\": [\n\t\t\t{\n\t\t\t\t\"name\": \"web-1000\",\n\t\t\t\t\"hostname\": \"beryllium\",\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"web-1001\",\n\t\t\t\t\"hostname\": \"boron\",\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"db-1000\",\n\t\t\t\t\"hostname\": \"carbon\",\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\t\"region\": \"west\",\n\t\t\"name\": \"dev\",\n\t\t\"servers\": [\n\t\t\t{\n\t\t\t\t\"name\": \"web-dev\",\n\t\t\t\t\"hostname\": \"nitrogen\",\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"name\": \"db-dev\",\n\t\t\t\t\"hostname\": \"oxygen\",\n\t\t\t},\n\t\t],\n\t},\n]\n\napps := [\n\t{\n\t\t\"name\": \"web\",\n\t\t\"servers\": [\"web-0\", \"web-1\", \"web-1000\", \"web-1001\", \"web-dev\"],\n\t},\n\t{\n\t\t\"name\": \"mysql\",\n\t\t\"servers\": [\"db-0\", \"db-1000\"],\n\t},\n\t{\n\t\t\"name\": \"mongodb\",\n\t\t\"servers\": [\"db-dev\"],\n\t},\n]\n\ncontainers := [\n\t{\n\t\t\"image\": \"redis\",\n\t\t\"ipaddress\": \"10.0.0.1\",\n\t\t\"name\": \"big_stallman\",\n\t},\n\t{\n\t\t\"image\": \"nginx\",\n\t\t\"ipaddress\": \"10.0.0.2\",\n\t\t\"name\": \"cranky_euclid\",\n\t},\n]\n"
			],
			"want_result": [
				{
					"x": "web"
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "name"
						},
						{
							"value": "prod"
						},
						{
							"value": "region"
						},
						{
							"value": "east"
						},
						{
							"value": "servers"
						},
						{
							"value": "hostname"
						},
						{
							"value": "hydrogen"
						},
						{
							"value": "web-0"
						},
						{
							"value": "helium"
						},
						{
							"value": "web-1"
						},
						{
							"value": "lithium"
						},
						{
							"value": "db-0"
						},
						{
							"value": "smoke"
						},
						{
							"value": "west"
						},
						{
							"value": "beryllium"
						},
						{
							"value": "web-1000"
						},
						{
							"value": "boron"
						},
						{
							"value": "web-1001"
						},
						{
							"value": "carbon"
						},
						{
							"value": "db-1000"
						},
						{
							"value": "dev"
						},
						{
							"value": "nitrogen"
						},
						{
							"value": "web-dev"
						},
						{
							"value": "oxygen"
						},
						{
							"value": "db-dev"
						},
						{
							"value": "web"
						},
						{
							"value": "mysql"
						},
						{
							"value": "mongodb"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.example.apps_by_hostname",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "DotStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"key": {
													"type": "string_index",
													"value": 9
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 5,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 4
												},
												"object": 5,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 5,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.example.sites",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 2
												},
												"object": 5,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 3
												},
												"value": {
													"type": "string_index",
													"value": 4
												},
												"object": 5,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 6,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 7,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 7
												},
												"object": 7,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 8
												},
												"object": 7,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 7
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 9
												},
												"object": 8,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 10
												},
												"object": 8,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 8
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 11
												},
												"object": 9,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 12
												},
												"object": 9,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 9
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 6
												},
												"object": 5,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 5
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 10,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 13
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 3
												},
												"value": {
													"type": "string_index",
													"value": 14
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 11,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 12,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 15
												},
												"object": 12,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 16
												},
												"object": 12,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 12
												},
												"array": 11,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 13,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 17
												},
												"object": 13,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 18
												},
												"object": 13,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 13
												},
												"array": 11,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 14,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 19
												},
												"object": 14,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 20
												},
												"object": 14,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 14
												},
												"array": 11,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 11
												},
												"object": 10,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 10
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 15,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 21
												},
												"object": 15,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 3
												},
												"value": {
													"type": "string_index",
													"value": 14
												},
												"object": 15,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 2,
												"target": 16,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 17,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 22
												},
												"object": 17,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 23
												},
												"object": 17,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 17
												},
												"array": 16,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 18,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 6
												},
												"value": {
													"type": "string_index",
													"value": 24
												},
												"object": 18,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 25
												},
												"object": 18,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 18
												},
												"array": 16,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 16
												},
												"object": 15,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 15
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 11
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 11
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 11
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 11
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"example",
								"sites"
							]
						},
						{
							"name": "g0.data.example.apps",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 3,
												"target": 4,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 5,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 26
												},
												"object": 5,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 5,
												"target": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 8
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 10
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 16
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 18
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 23
												},
												"array": 6,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 6
												},
												"object": 5,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 5
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 7,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 27
												},
												"object": 7,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 2,
												"target": 8,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 12
												},
												"array": 8,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 20
												},
												"array": 8,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 8
												},
												"object": 7,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 7
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 9,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 1
												},
												"value": {
													"type": "string_index",
													"value": 28
												},
												"object": 9,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "MakeArrayStmt",
											"stmt": {
												"capacity": 1,
												"target": 10,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "string_index",
													"value": 25
												},
												"array": 10,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 5
												},
												"value": {
													"type": "local",
													"value": 10
												},
												"object": 9,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "ArrayAppendStmt",
											"stmt": {
												"value": {
													"type": "local",
													"value": 9
												},
												"array": 4,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 4
												},
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 64
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "IsDefinedStmt",
											"stmt": {
												"source": 3,
												"file": 0,
												"col": 1,
												"row": 64
											}
										},
										{
											"type": "AssignVarOnceStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 3
												},
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 64
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 64
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"example",
								"apps"
							]
						},
						{
							"name": "g0.data.example.apps_by_hostname",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.example.sites",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 4,
												"file": 0,
												"col": 2,
												"row": 5
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 4,
												"key": 5,
												"value": 6,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 5
																},
																"target": 7,
																"file": 0,
																"col": 2,
																"row": 5
															}
														},
														{
															"type": "DotStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 6
																},
																"key": {
																	"type": "string_index",
																	"value": 5
																},
																"target": 8,
																"file": 0,
																"col": 2,
																"row": 5
															}
														},
														{
															"type": "ScanStmt",
															"stmt": {
																"source": 8,
																"key": 9,
																"value": 10,
																"block": {
																	"stmts": [
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 9
																				},
																				"target": 11,
																				"file": 0,
																				"col": 2,
																				"row": 5
																			}
																		},
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 10
																				},
																				"target": 12,
																				"file": 0,
																				"col": 2,
																				"row": 5
																			}
																		},
																		{
																			"type": "DotStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 12
																				},
																				"key": {
																					"type": "string_index",
																					"value": 6
																				},
																				"target": 13,
																				"file": 0,
																				"col": 2,
																				"row": 6
																			}
																		},
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 13
																				},
																				"target": 14,
																				"file": 0,
																				"col": 2,
																				"row": 6
																			}
																		},
																		{
																			"type": "CallStmt",
																			"stmt": {
																				"func": "g0.data.example.apps",
																				"args": [
																					{
																						"type": "local",
																						"value": 0
																					},
																					{
																						"type": "local",
																						"value": 1
																					}
																				],
																				"result": 15,
																				"file": 0,
																				"col": 2,
																				"row": 7
																			}
																		},
																		{
																			"type": "ScanStmt",
																			"stmt": {
																				"source": 15,
																				"key": 16,
																				"value": 17,
																				"block": {
																					"stmts": [
																						{
																							"type": "AssignVarStmt",
																							"stmt": {
																								"source": {
																									"type": "local",
																									"value": 16
																								},
																								"target": 18,
																								"file": 0,
																								"col": 2,
																								"row": 7
																							}
																						},
																						{
																							"type": "DotStmt",
																							"stmt": {
																								"source": {
																									"type": "local",
																									"value": 17
																								},
																								"key": {
																									"type": "string_index",
																									"value": 5
																								},
																								"target": 19,
																								"file": 0,
																								"col": 2,
																								"row": 7
																							}
																						},
																						{
																							"type": "ScanStmt",
																							"stmt": {
																								"source": 19,
																								"key": 20,
																								"value": 21,
																								"block": {
																									"stmts": [
																										{
																											"type": "AssignVarStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 20
																												},
																												"target": 22,
																												"file": 0,
																												"col": 2,
																												"row": 7
																											}
																										},
																										{
																											"type": "DotStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 12
																												},
																												"key": {
																													"type": "string_index",
																													"value": 1
																												},
																												"target": 23,
																												"file": 0,
																												"col": 2,
																												"row": 7
																											}
																										},
																										{
																											"type": "EqualStmt",
																											"stmt": {
																												"a": {
																													"type": "local",
																													"value": 21
																												},
																												"b": {
																													"type": "local",
																													"value": 23
																												},
																												"file": 0,
																												"col": 2,
																												"row": 7
																											}
																										},
																										{
																											"type": "CallStmt",
																											"stmt": {
																												"func": "g0.data.example.apps",
																												"args": [
																													{
																														"type": "local",
																														"value": 0
																													},
																													{
																														"type": "local",
																														"value": 1
																													}
																												],
																												"result": 24,
																												"file": 0,
																												"col": 2,
																												"row": 8
																											}
																										},
																										{
																											"type": "DotStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 24
																												},
																												"key": {
																													"type": "local",
																													"value": 18
																												},
																												"target": 25,
																												"file": 0,
																												"col": 2,
																												"row": 8
																											}
																										},
																										{
																											"type": "DotStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 25
																												},
																												"key": {
																													"type": "string_index",
																													"value": 1
																												},
																												"target": 26,
																												"file": 0,
																												"col": 2,
																												"row": 8
																											}
																										},
																										{
																											"type": "AssignVarStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 26
																												},
																												"target": 27,
																												"file": 0,
																												"col": 2,
																												"row": 8
																											}
																										},
																										{
																											"type": "ObjectInsertOnceStmt",
																											"stmt": {
																												"key": {
																													"type": "local",
																													"value": 14
																												},
																												"value": {
																													"type": "local",
																													"value": 27
																												},
																												"object": 2,
																												"file": 0,
																												"col": 1,
																												"row": 3
																											}
																										}
																									]
																								},
																								"file": 0,
																								"col": 2,
																								"row": 7
																							}
																						}
																					]
																				},
																				"file": 0,
																				"col": 2,
																				"row": 7
																			}
																		}
																	]
																},
																"file": 0,
																"col": 2,
																"row": 5
															}
														}
													]
												},
												"file": 0,
												"col": 2,
												"row": 5
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"example",
								"apps_by_hostname"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": "web"
				}
			]
		},
		{
			"note": "refheads/website-example/partial-set",
			"query": "data.example.public_network = x",
			"modules": [
				"package example\n\npublic_network contains net.id if {\n\tsome net in input.networks\n\tnet.public\n}\n"
			],
			"input": {
				"networks": [
					{
						"id": "n1",
						"public": true
					},
					{
						"id": "n2",
						"public": false
					}
				]
			},
			"want_result": [
				{
					"x": [
						"n1"
					]
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "networks"
						},
						{
							"value": "public"
						},
						{
							"value": "id"
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.example.public_network",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.example.public_network",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeSetStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "DotStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 0
												},
												"key": {
													"type": "string_index",
													"value": 1
												},
												"target": 4,
												"file": 0,
												"col": 2,
												"row": 4
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 4,
												"key": 5,
												"value": 6,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 5
																},
																"target": 7,
																"file": 0,
																"col": 2,
																"row": 4
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 6
																},
																"target": 8,
																"file": 0,
																"col": 2,
																"row": 4
															}
														},
														{
															"type": "DotStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 8
																},
																"key": {
																	"type": "string_index",
																	"value": 2
																},
																"target": 9,
																"file": 0,
																"col": 2,
																"row": 5
															}
														},
														{
															"type": "NotEqualStmt",
															"stmt": {
																"a": {
																	"type": "local",
																	"value": 9
																},
																"b": {
																	"type": "bool",
																	"value": false
																},
																"file": 0,
																"col": 2,
																"row": 5
															}
														},
														{
															"type": "DotStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 8
																},
																"key": {
																	"type": "string_index",
																	"value": 3
																},
																"target": 10,
																"file": 0,
																"col": 25,
																"row": 3
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 10
																},
																"target": 11,
																"file": 0,
																"col": 25,
																"row": 3
															}
														},
														{
															"type": "SetAddStmt",
															"stmt": {
																"value": {
																	"type": "local",
																	"value": 11
																},
																"set": 2,
																"file": 0,
																"col": 1,
																"row": 3
															}
														}
													]
												},
												"file": 0,
												"col": 2,
												"row": 4
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"example",
								"public_network"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": [
						"n1"
					]
				}
			]
		},
		{
			"note": "refheads/many-vars",
			"query": "data.test.p = x",
			"modules": [
				"package test\n\np[a][b][c][d][e] if {\n\tsome a in numbers.range(1, 5)\n\tsome b in numbers.range(1, 5)\n\tsome c in numbers.range(1, 5)\n\tsome d in numbers.range(1, 5)\n\tsome e in numbers.range(1, 5)\n\t(((a + b) + c) + d) + e == 24\n}\n"
			],
			"want_result": [
				{
					"x": {
						"4": {
							"5": {
								"5": {
									"5": {
										"5": true
									}
								}
							}
						},
						"5": {
							"4": {
								"5": {
									"5": {
										"5": true
									}
								}
							},
							"5": {
								"4": {
									"5": {
										"5": true
									}
								},
								"5": {
									"4": {
										"5": true
									},
									"5": {
										"4": true
									}
								}
							}
						}
					}
				}
			],
			"ignore_generated_vars": false,
			"entrypoints": [
				"eval"
			],
			"plan": {
				"static": {
					"strings": [
						{
							"value": "x"
						},
						{
							"value": "1"
						},
						{
							"value": "5"
						},
						{
							"value": "24"
						}
					],
					"builtin_funcs": [
						{
							"name": "numbers.range",
							"decl": {
								"args": [
									{
										"description": "the start of the range",
										"name": "a",
										"type": "number"
									},
									{
										"description": "the end of the range (inclusive)",
										"name": "b",
										"type": "number"
									}
								],
								"result": {
									"description": "the range between `a` and `b`",
									"dynamic": {
										"type": "number"
									},
									"name": "range",
									"type": "array"
								},
								"type": "function"
							}
						},
						{
							"name": "plus",
							"decl": {
								"args": [
									{
										"name": "x",
										"type": "number"
									},
									{
										"name": "y",
										"type": "number"
									}
								],
								"result": {
									"description": "the sum of `x` and `y`",
									"name": "z",
									"type": "number"
								},
								"type": "function"
							}
						}
					],
					"files": [
						{
							"value": "module-0.rego"
						},
						{
							"value": "\u003cquery\u003e"
						}
					]
				},
				"plans": {
					"plans": [
						{
							"name": "eval",
							"blocks": [
								{
									"stmts": [
										{
											"type": "CallStmt",
											"stmt": {
												"func": "g0.data.test.p",
												"args": [
													{
														"type": "local",
														"value": 0
													},
													{
														"type": "local",
														"value": 1
													}
												],
												"result": 2,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 2
												},
												"target": 3,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ObjectInsertStmt",
											"stmt": {
												"key": {
													"type": "string_index",
													"value": 0
												},
												"value": {
													"type": "local",
													"value": 3
												},
												"object": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										},
										{
											"type": "ResultSetAddStmt",
											"stmt": {
												"value": 4,
												"file": 1,
												"col": 1,
												"row": 1
											}
										}
									]
								}
							]
						}
					]
				},
				"funcs": {
					"funcs": [
						{
							"name": "g0.data.test.p",
							"params": [
								0,
								1
							],
							"return": 2,
							"blocks": [
								{
									"stmts": [
										{
											"type": "MakeObjectStmt",
											"stmt": {
												"target": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ResetLocalStmt",
											"stmt": {
												"target": 3,
												"file": 0,
												"col": 1,
												"row": 3
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 1,
												"target": 4,
												"file": 0,
												"col": 12,
												"row": 4
											}
										},
										{
											"type": "MakeNumberRefStmt",
											"stmt": {
												"Index": 2,
												"target": 5,
												"file": 0,
												"col": 12,
												"row": 4
											}
										},
										{
											"type": "CallStmt",
											"stmt": {
												"func": "numbers.range",
												"args": [
													{
														"type": "local",
														"value": 4
													},
													{
														"type": "local",
														"value": 5
													}
												],
												"result": 6,
												"file": 0,
												"col": 12,
												"row": 4
											}
										},
										{
											"type": "AssignVarStmt",
											"stmt": {
												"source": {
													"type": "local",
													"value": 6
												},
												"target": 7,
												"file": 0,
												"col": 12,
												"row": 4
											}
										},
										{
											"type": "ScanStmt",
											"stmt": {
												"source": 7,
												"key": 8,
												"value": 9,
												"block": {
													"stmts": [
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 8
																},
																"target": 10,
																"file": 0,
																"col": 2,
																"row": 4
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 9
																},
																"target": 11,
																"file": 0,
																"col": 2,
																"row": 4
															}
														},
														{
															"type": "MakeNumberRefStmt",
															"stmt": {
																"Index": 1,
																"target": 12,
																"file": 0,
																"col": 12,
																"row": 5
															}
														},
														{
															"type": "MakeNumberRefStmt",
															"stmt": {
																"Index": 2,
																"target": 13,
																"file": 0,
																"col": 12,
																"row": 5
															}
														},
														{
															"type": "CallStmt",
															"stmt": {
																"func": "numbers.range",
																"args": [
																	{
																		"type": "local",
																		"value": 12
																	},
																	{
																		"type": "local",
																		"value": 13
																	}
																],
																"result": 14,
																"file": 0,
																"col": 12,
																"row": 5
															}
														},
														{
															"type": "AssignVarStmt",
															"stmt": {
																"source": {
																	"type": "local",
																	"value": 14
																},
																"target": 15,
																"file": 0,
																"col": 12,
																"row": 5
															}
														},
														{
															"type": "ScanStmt",
															"stmt": {
																"source": 15,
																"key": 16,
																"value": 17,
																"block": {
																	"stmts": [
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 16
																				},
																				"target": 18,
																				"file": 0,
																				"col": 2,
																				"row": 5
																			}
																		},
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 17
																				},
																				"target": 19,
																				"file": 0,
																				"col": 2,
																				"row": 5
																			}
																		},
																		{
																			"type": "MakeNumberRefStmt",
																			"stmt": {
																				"Index": 1,
																				"target": 20,
																				"file": 0,
																				"col": 12,
																				"row": 6
																			}
																		},
																		{
																			"type": "MakeNumberRefStmt",
																			"stmt": {
																				"Index": 2,
																				"target": 21,
																				"file": 0,
																				"col": 12,
																				"row": 6
																			}
																		},
																		{
																			"type": "CallStmt",
																			"stmt": {
																				"func": "numbers.range",
																				"args": [
																					{
																						"type": "local",
																						"value": 20
																					},
																					{
																						"type": "local",
																						"value": 21
																					}
																				],
																				"result": 22,
																				"file": 0,
																				"col": 12,
																				"row": 6
																			}
																		},
																		{
																			"type": "AssignVarStmt",
																			"stmt": {
																				"source": {
																					"type": "local",
																					"value": 22
																				},
																				"target": 23,
																				"file": 0,
																				"col": 12,
																				"row": 6
																			}
																		},
																		{
																			"type": "ScanStmt",
																			"stmt": {
																				"source": 23,
																				"key": 24,
																				"value": 25,
																				"block": {
																					"stmts": [
																						{
																							"type": "AssignVarStmt",
																							"stmt": {
																								"source": {
																									"type": "local",
																									"value": 24
																								},
																								"target": 26,
																								"file": 0,
																								"col": 2,
																								"row": 6
																							}
																						},
																						{
																							"type": "AssignVarStmt",
																							"stmt": {
																								"source": {
																									"type": "local",
																									"value": 25
																								},
																								"target": 27,
																								"file": 0,
																								"col": 2,
																								"row": 6
																							}
																						},
																						{
																							"type": "MakeNumberRefStmt",
																							"stmt": {
																								"Index": 1,
																								"target": 28,
																								"file": 0,
																								"col": 12,
																								"row": 7
																							}
																						},
																						{
																							"type": "MakeNumberRefStmt",
																							"stmt": {
																								"Index": 2,
																								"target": 29,
																								"file": 0,
																								"col": 12,
																								"row": 7
																							}
																						},
																						{
																							"type": "CallStmt",
																							"stmt": {
																								"func": "numbers.range",
																								"args": [
																									{
																										"type": "local",
																										"value": 28
																									},
																									{
																										"type": "local",
																										"value": 29
																									}
																								],
																								"result": 30,
																								"file": 0,
																								"col": 12,
																								"row": 7
																							}
																						},
																						{
																							"type": "AssignVarStmt",
																							"stmt": {
																								"source": {
																									"type": "local",
																									"value": 30
																								},
																								"target": 31,
																								"file": 0,
																								"col": 12,
																								"row": 7
																							}
																						},
																						{
																							"type": "ScanStmt",
																							"stmt": {
																								"source": 31,
																								"key": 32,
																								"value": 33,
																								"block": {
																									"stmts": [
																										{
																											"type": "AssignVarStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 32
																												},
																												"target": 34,
																												"file": 0,
																												"col": 2,
																												"row": 7
																											}
																										},
																										{
																											"type": "AssignVarStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 33
																												},
																												"target": 35,
																												"file": 0,
																												"col": 2,
																												"row": 7
																											}
																										},
																										{
																											"type": "MakeNumberRefStmt",
																											"stmt": {
																												"Index": 1,
																												"target": 36,
																												"file": 0,
																												"col": 12,
																												"row": 8
																											}
																										},
																										{
																											"type": "MakeNumberRefStmt",
																											"stmt": {
																												"Index": 2,
																												"target": 37,
																												"file": 0,
																												"col": 12,
																												"row": 8
																											}
																										},
																										{
																											"type": "CallStmt",
																											"stmt": {
																												"func": "numbers.range",
																												"args": [
																													{
																														"type": "local",
																														"value": 36
																													},
																													{
																														"type": "local",
																														"value": 37
																													}
																												],
																												"result": 38,
																												"file": 0,
																												"col": 12,
																												"row": 8
																											}
																										},
																										{
																											"type": "AssignVarStmt",
																											"stmt": {
																												"source": {
																													"type": "local",
																													"value": 38
																												},
																												"target": 39,
																												"file": 0,
																												"col": 12,
																												"row": 8
																											}
																										},
																										{
																											"type": "ScanStmt",
																											"stmt": {
																												"source": 39,
																												"key": 40,
																												"value": 41,
																												"block": {
																													"stmts": [
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 40
																																},
																																"target": 42,
																																"file": 0,
																																"col": 2,
																																"row": 8
																															}
																														},
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 41
																																},
																																"target": 43,
																																"file": 0,
																																"col": 2,
																																"row": 8
																															}
																														},
																														{
																															"type": "CallStmt",
																															"stmt": {
																																"func": "plus",
																																"args": [
																																	{
																																		"type": "local",
																																		"value": 11
																																	},
																																	{
																																		"type": "local",
																																		"value": 19
																																	}
																																],
																																"result": 44,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 44
																																},
																																"target": 45,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "CallStmt",
																															"stmt": {
																																"func": "plus",
																																"args": [
																																	{
																																		"type": "local",
																																		"value": 45
																																	},
																																	{
																																		"type": "local",
																																		"value": 27
																																	}
																																],
																																"result": 46,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 46
																																},
																																"target": 47,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "CallStmt",
																															"stmt": {
																																"func": "plus",
																																"args": [
																																	{
																																		"type": "local",
																																		"value": 47
																																	},
																																	{
																																		"type": "local",
																																		"value": 35
																																	}
																																],
																																"result": 48,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 48
																																},
																																"target": 49,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "CallStmt",
																															"stmt": {
																																"func": "plus",
																																"args": [
																																	{
																																		"type": "local",
																																		"value": 49
																																	},
																																	{
																																		"type": "local",
																																		"value": 43
																																	}
																																],
																																"result": 50,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "AssignVarStmt",
																															"stmt": {
																																"source": {
																																	"type": "local",
																																	"value": 50
																																},
																																"target": 51,
																																"file": 0,
																																"col": 5,
																																"row": 9
																															}
																														},
																														{
																															"type": "MakeNumberRefStmt",
																															"stmt": {
																																"Index": 3,
																																"target": 52,
																																"file": 0,
																																"col": 2,
																																"row": 9
																															}
																														},
																														{
																															"type": "EqualStmt",
																															"stmt": {
																																"a": {
																																	"type": "local",
																																	"value": 51
																																},
																																"b": {
																																	"type": "local",
																																	"value": 52
																																},
																																"file": 0,
																																"col": 2,
																																"row": 9
																															}
																														},
																														{
																															"type": "BlockStmt",
																															"stmt": {
																																"blocks": [
																																	{
																																		"stmts": [
																																			{
																																				"type": "BlockStmt",
																																				"stmt": {
																																					"blocks": [
																																						{
																																							"stmts": [
																																								{
																																									"type": "DotStmt",
																																									"stmt": {
																																										"source": {
																																											"type": "local",
																																											"value": 2
																																										},
																																										"key": {
																																											"type": "local",
																																											"value": 11
																																										},
																																										"target": 53,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								},
																																								{
																																									"type": "BreakStmt",
																																									"stmt": {
																																										"index": 1,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								}
																																							]
																																						}
																																					],
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			},
																																			{
																																				"type": "MakeObjectStmt",
																																				"stmt": {
																																					"target": 53,
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			}
																																		]
																																	}
																																],
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "BlockStmt",
																															"stmt": {
																																"blocks": [
																																	{
																																		"stmts": [
																																			{
																																				"type": "BlockStmt",
																																				"stmt": {
																																					"blocks": [
																																						{
																																							"stmts": [
																																								{
																																									"type": "DotStmt",
																																									"stmt": {
																																										"source": {
																																											"type": "local",
																																											"value": 53
																																										},
																																										"key": {
																																											"type": "local",
																																											"value": 19
																																										},
																																										"target": 54,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								},
																																								{
																																									"type": "BreakStmt",
																																									"stmt": {
																																										"index": 1,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								}
																																							]
																																						}
																																					],
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			},
																																			{
																																				"type": "MakeObjectStmt",
																																				"stmt": {
																																					"target": 54,
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			}
																																		]
																																	}
																																],
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "BlockStmt",
																															"stmt": {
																																"blocks": [
																																	{
																																		"stmts": [
																																			{
																																				"type": "BlockStmt",
																																				"stmt": {
																																					"blocks": [
																																						{
																																							"stmts": [
																																								{
																																									"type": "DotStmt",
																																									"stmt": {
																																										"source": {
																																											"type": "local",
																																											"value": 54
																																										},
																																										"key": {
																																											"type": "local",
																																											"value": 27
																																										},
																																										"target": 55,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								},
																																								{
																																									"type": "BreakStmt",
																																									"stmt": {
																																										"index": 1,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								}
																																							]
																																						}
																																					],
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			},
																																			{
																																				"type": "MakeObjectStmt",
																																				"stmt": {
																																					"target": 55,
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			}
																																		]
																																	}
																																],
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "BlockStmt",
																															"stmt": {
																																"blocks": [
																																	{
																																		"stmts": [
																																			{
																																				"type": "BlockStmt",
																																				"stmt": {
																																					"blocks": [
																																						{
																																							"stmts": [
																																								{
																																									"type": "DotStmt",
																																									"stmt": {
																																										"source": {
																																											"type": "local",
																																											"value": 55
																																										},
																																										"key": {
																																											"type": "local",
																																											"value": 35
																																										},
																																										"target": 56,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								},
																																								{
																																									"type": "BreakStmt",
																																									"stmt": {
																																										"index": 1,
																																										"file": 0,
																																										"col": 1,
																																										"row": 3
																																									}
																																								}
																																							]
																																						}
																																					],
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			},
																																			{
																																				"type": "MakeObjectStmt",
																																				"stmt": {
																																					"target": 56,
																																					"file": 0,
																																					"col": 0,
																																					"row": 0
																																				}
																																			}
																																		]
																																	}
																																],
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "ObjectInsertOnceStmt",
																															"stmt": {
																																"key": {
																																	"type": "local",
																																	"value": 43
																																},
																																"value": {
																																	"type": "bool",
																																	"value": true
																																},
																																"object": 56,
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "ObjectInsertStmt",
																															"stmt": {
																																"key": {
																																	"type": "local",
																																	"value": 35
																																},
																																"value": {
																																	"type": "local",
																																	"value": 56
																																},
																																"object": 55,
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "ObjectInsertStmt",
																															"stmt": {
																																"key": {
																																	"type": "local",
																																	"value": 27
																																},
																																"value": {
																																	"type": "local",
																																	"value": 55
																																},
																																"object": 54,
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "ObjectInsertStmt",
																															"stmt": {
																																"key": {
																																	"type": "local",
																																	"value": 19
																																},
																																"value": {
																																	"type": "local",
																																	"value": 54
																																},
																																"object": 53,
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														},
																														{
																															"type": "ObjectInsertStmt",
																															"stmt": {
																																"key": {
																																	"type": "local",
																																	"value": 11
																																},
																																"value": {
																																	"type": "local",
																																	"value": 53
																																},
																																"object": 2,
																																"file": 0,
																																"col": 1,
																																"row": 3
																															}
																														}
																													]
																												},
																												"file": 0,
																												"col": 2,
																												"row": 8
																											}
																										}
																									]
																								},
																								"file": 0,
																								"col": 2,
																								"row": 7
																							}
																						}
																					]
																				},
																				"file": 0,
																				"col": 2,
																				"row": 6
																			}
																		}
																	]
																},
																"file": 0,
																"col": 2,
																"row": 5
															}
														}
													]
												},
												"file": 0,
												"col": 2,
												"row": 4
											}
										}
									]
								},
								{
									"stmts": [
										{
											"type": "ReturnLocalStmt",
											"stmt": {
												"source": 2,
												"file": 0,
												"col": 1,
												"row": 3
											}
										}
									]
								}
							],
							"path": [
								"g0",
								"test",
								"p"
							]
						}
					]
				}
			},
			"want_plan_result": [
				{
					"x": {
						"4": {
							"5": {
								"5": {
									"5": {
										"5": true
									}
								}
							}
						},
						"5": {
							"4": {
								"5": {
									"5": {
										"5": true
									}
								}
							},
							"5": {
								"4": {
									"5": {
										"5": true
									}
								},
								"5": {
									"4": {
										"5": true
									},
									"5": {
										"4": true
									}
								}
							}
						}
					}
				}
			]
		}
	]
}